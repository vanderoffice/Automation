---
phase: 03-form-ui
plan: 01
type: execute
---

<objective>
Build the agreement form shell with track selection and employee/department info fields.

Purpose: Replace the component preview showcase in AgreementPage with the actual ECOS agreement form — the core UI users interact with. Auto-fills employee data from RoleContext so the demo feels like a real authenticated session.
Output: Working form page with track selector (New/Updated User vs Annual Renewal), auto-populated employee fields, and editable department/supervisor fields.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (direct dependencies):
@.planning/phases/01-foundation/01-03-SUMMARY.md
@.planning/phases/02-database-api/02-02-SUMMARY.md
@.planning/phases/02-database-api/02-03-SUMMARY.md

# Key source files:
@src/pages/AgreementPage.jsx
@src/components/ui/index.js
@src/components/ui/TextInput.jsx
@src/components/ui/Select.jsx
@src/components/ui/Card.jsx
@src/components/ui/SectionHeader.jsx
@src/context/RoleContext.jsx
@src/lib/api/agreements.js
@sql/001-schema.sql

**Tech stack available:** React 18, React Router 6, Tailwind CSS 3, @supabase/supabase-js
**Established patterns:** atomic-component-library, variant-props-pattern, forwardRef-form-inputs, barrel-export, react-context-provider, layout-route-with-outlet
**Constraining decisions:**
- Phase 01-03: No clsx/twMerge — plain string concatenation for className logic
- Phase 01-03: Barrel export from src/components/ui/index.js
- Phase 02-02: Supabase client targets ecos schema, persistSession: false
- Phase 02-03: useRole() provides currentEmployee, role, departmentId, employees, switchRole
- Phase 02-03: localStorage for selected employee ID persistence
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace AgreementPage with form shell and track selector</name>
  <files>src/pages/AgreementPage.jsx, src/components/form/TrackSelector.jsx, src/components/form/AgreementForm.jsx</files>
  <action>
  **AgreementPage.jsx:** Gut the existing component preview showcase entirely. Replace with a page that:
  - Uses useRole() to get currentEmployee and loading state
  - Shows a loading spinner while RoleContext loads
  - If no currentEmployee, shows an Alert prompting to select a role
  - Otherwise renders AgreementForm with currentEmployee passed as prop

  **TrackSelector.jsx:** Create a track selection component that:
  - Displays two Card-based options side by side (responsive: stack on mobile, row on desktop)
  - "New / Updated User" card: icon/emoji, title, brief description ("Complete security agreement with full access group selection")
  - "Annual Renewal" card: icon/emoji, title, brief description ("Confirm existing access and renew for the current fiscal year")
  - Selected track gets orange border/glow styling (border-orange-500, glow-box), unselected gets neutral-800 border
  - Clicking a card sets the track value
  - Props: value, onChange

  **AgreementForm.jsx:** Create the main form component that:
  - Accepts currentEmployee prop
  - Manages form state with useState: { track: null, supervisorName: '', workPhone: '', workLocation: '', fiscalYear: auto-calculated }
  - Auto-calculate fiscalYear: if current month >= July, use "YYYY-(YYYY+1)", else use "(YYYY-1)-YYYY" (California fiscal year runs July-June)
  - Step 1: Show TrackSelector when track is null
  - Step 2: Once track selected, show the form sections (employee info rendered in Task 2, security content and access groups in later plans)
  - Include a "Back" link/button to change track selection
  - Wrap in a max-w-3xl container centered in the page

  Create src/components/form/ directory for form-specific components (separate from src/components/ui/ which is the generic design system).

  **Avoid:** Don't install any form library (react-hook-form, formik). Plain useState is sufficient for this form's complexity. Don't add validation yet — that's Plan 03-03.
  </action>
  <verify>
  Dev server running on port 5180. Navigate to /ecosform/agreement:
  - Two track cards visible, clickable, orange highlight on selection
  - Selecting a track transitions to the form view
  - Back button returns to track selection
  - No console errors
  </verify>
  <done>AgreementPage renders TrackSelector, selecting a track shows AgreementForm shell with back navigation. No remnants of the old component preview.</done>
</task>

<task type="auto">
  <name>Task 2: Employee info and department fields</name>
  <files>src/components/form/EmployeeInfoSection.jsx, src/components/form/DepartmentInfoSection.jsx, src/components/form/AgreementForm.jsx</files>
  <action>
  **EmployeeInfoSection.jsx:** Create a read-only employee info display that:
  - Takes currentEmployee as prop
  - Uses SectionHeader with title "Employee Information"
  - Displays in a Card: employee name (first + last), employee number, email, title, department name
  - Use a 2-column grid (responsive: 1 col mobile, 2 col md+) of labeled value pairs
  - Values displayed as styled text (not editable inputs) — these come from the employee record
  - Style: label in text-neutral-400 text-sm, value in text-white font-medium
  - For Annual Renewal track: also show a note "Renewing agreement from previous fiscal year"

  **DepartmentInfoSection.jsx:** Create editable department context fields:
  - Takes formState and onChange handler as props
  - Uses SectionHeader with title "Department & Supervisor"
  - Inside a Card, render three fields using TextInput components:
    - Supervisor Name (pre-fill from currentEmployee's seed data supervisor_name if an existing agreement exists, otherwise empty)
    - Work Phone (placeholder: "(916) 555-0000")
    - Work Location (placeholder: "Sacramento HQ")
  - 2-column grid for phone and location, full-width for supervisor name
  - Show fiscal year as a read-only Badge next to the section header (e.g., "FY 2025-2026")

  **AgreementForm.jsx update:** Wire both sections into the form:
  - After track selection, render: page title ("ECOS Security Agreement — New/Updated User" or "— Annual Renewal"), EmployeeInfoSection, DepartmentInfoSection
  - Pass formState and handleChange function to DepartmentInfoSection
  - handleChange should update the specific field in formState

  **Avoid:** Don't add form submission or validation — those are in Plan 03-03. Don't fetch existing agreements to pre-fill — just use empty defaults for now. The form is building up incrementally across three plans.
  </action>
  <verify>
  Navigate to /ecosform/agreement, select a track:
  - Employee info card shows current demo employee's name, number, email, title, department
  - Department section shows three editable inputs (supervisor, phone, location)
  - Fiscal year badge displays correctly
  - Switch demo roles via existing role context — employee info updates automatically
  - All fields properly styled in dark theme with orange focus rings
  </verify>
  <done>Form shows read-only employee info from RoleContext and three editable department fields. Fiscal year auto-calculated. Role switching updates the employee info section immediately.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] AgreementPage no longer shows component preview — fully replaced with form
- [ ] Track selection works (both cards, visual feedback, back navigation)
- [ ] Employee info populates from useRole() context
- [ ] Department fields are editable with proper styling
- [ ] Fiscal year auto-calculated correctly
- [ ] Switching demo roles updates employee info
- [ ] No console errors or warnings
- [ ] `npm run build` succeeds (if build script exists)
</verification>

<success_criteria>

- AgreementPage fully replaced with form shell
- Track selector with two options (new_updated, annual_renewal)
- Auto-filled employee info from RoleContext
- Editable supervisor/phone/location fields
- Fiscal year auto-calculated
- All tasks completed, all verification checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-form-ui/03-01-SUMMARY.md`
</output>
