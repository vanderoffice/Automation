---
phase: 06-admin-dashboard
plan: 02
type: execute
---

<objective>
Build the pending approval queue section of the admin dashboard — a prioritized list of agreements awaiting admin sign-off with one-click signing capability.

Purpose: Show executives how admin workflow is streamlined — pending items are surfaced automatically, actionable inline without navigating away.
Output: Approval queue section in DashboardPage with pending agreements and inline signing.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-admin-dashboard/06-01-SUMMARY.md

# Key source files:
@src/pages/DashboardPage.jsx
@src/pages/WorkflowPage.jsx
@src/lib/api/workflow.js
@src/lib/api/signatures.js
@src/lib/api/audit.js
@src/lib/api/index.js
@src/components/form/SignatureBlock.jsx
@src/lib/auditMeta.js

**Tech stack available:** React 18, Supabase JS, Tailwind CSS 3
**Established patterns:** SignatureBlock component for inline signing, advanceWorkflow + logAction pattern for state transitions, getPendingForRole('admin') for admin pending items

**Constraining decisions:**
- Inline signing pattern established in WorkflowPage's AgreementCard component
- createSignature → advanceWorkflow → logAction sequence for signing
- getAuditMeta() for audit metadata collection
- SignatureBlock has active/disabled/signed sub-states

**Demo data available:** 3 agreements in pending_admin status (agreements 7, 11, 12), each with employee + manager signatures already recorded. Perfect for admin approval queue demo.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build pending approval queue with inline admin signing</name>
  <files>src/pages/DashboardPage.jsx</files>
  <action>
Add a "Pending Approvals" section to the dashboard, positioned between the compliance overview stats and the department breakdown (most actionable items first — executives love seeing "what needs my attention now").

Use getPendingForRole('admin') to fetch agreements waiting for admin sign-off. For each pending agreement, display a compact card showing:
- Employee name + department
- Agreement track (New/Updated or Annual Renewal) as Badge
- "Waiting X days" since last signature (manager's sign date)
- Inline SignatureBlock component for one-click admin signing

Follow the same signing handler pattern from WorkflowPage's AgreementCard:
1. createSignature with audit metadata (getAuditMeta)
2. advanceWorkflow(agreementId, { signer_role: 'admin' })
3. logAction(agreementId, actorId, 'signed', { role: 'admin', typed_name })
4. Reload dashboard data after successful sign

Import SignatureBlock from '../components/form/SignatureBlock' and getAuditMeta from '../lib/auditMeta.js'.

For the signer name, use a hardcoded admin name from context or derive from the current demo identity. Since this is an admin-only dashboard view, use a reasonable default like "Admin" — but ideally pull from the employees list (the admin employees in seed data are Casey Nguyen and Drew Martinez).

If no pending approvals: show a green checkmark with "All approvals current — no pending items" message.

After signing, the agreement should disappear from the queue (re-fetch data). This creates a satisfying "clear your inbox" UX for the executive demo.
  </action>
  <verify>Dashboard shows pending approvals section with 3 items (from demo data). Each has a SignatureBlock for admin signing. Signing an agreement removes it from the queue and updates stat cards.</verify>
  <done>Pending approvals queue shows correct admin-pending agreements, inline signing works end-to-end (signature recorded, workflow advanced, audit logged), signed items disappear from queue, stat cards update after signing.</done>
</task>

<task type="auto">
  <name>Task 2: Add approval queue sorting and visual priority indicators</name>
  <files>src/pages/DashboardPage.jsx</files>
  <action>
Enhance the approval queue with sorting and urgency indicators:

1. Sort pending items by wait time (longest waiting first — most overdue at top)
2. Add visual urgency: items waiting >7 days get a red-tinted left border, 3-7 days orange, <3 days neutral
3. Show a count badge in the section header: "Pending Approvals (3)"
4. Add a subtle "days waiting" indicator using the time since the last signature was recorded

Calculate wait time by comparing the current time to the agreement's updated_at (which reflects the last workflow transition). Use the same relative time formatting approach from WorkflowPage (formatRelativeTime pattern).

Keep this lightweight — the goal is visual polish for the executive demo, not complex sorting infrastructure.
  </action>
  <verify>Pending approvals sorted by wait time (longest first), urgency colors visible on left border, count badge in header shows correct number.</verify>
  <done>Approvals sorted by urgency, visual indicators show wait time severity, section header shows count.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Pending approvals section shows admin-pending agreements
- [ ] Inline signing works (creates signature, advances workflow, logs audit)
- [ ] Signed items disappear from queue after signing
- [ ] Stat cards update after approval actions
- [ ] Visual urgency indicators display correctly
- [ ] Empty state shows when no pending approvals
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Admin can sign pending agreements directly from dashboard
- Dashboard data refreshes after each action
- No console errors during signing flow
</success_criteria>

<output>
After completion, create `.planning/phases/06-admin-dashboard/06-02-SUMMARY.md`
</output>
