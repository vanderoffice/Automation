---
phase: 05-role-switcher-demo
plan: 01
type: execute
---

<objective>
Build a persistent, global role switcher component in the sidebar that lets demo viewers freely switch between Employee, Manager, and Admin perspectives. Remove the temporary role switcher from WorkflowPage.

Purpose: The role switcher is the core demo mechanic — executives need to seamlessly flip between perspectives to understand the three-party workflow. It must be always-visible, clearly show who you're viewing as, and instantly update all page content.
Output: RoleSwitcher component in sidebar footer (desktop + mobile), WorkflowPage temp switcher removed, all pages responding to role context changes.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Key prior phase work:
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/02-database-api/02-03-SUMMARY.md
@.planning/phases/04-signature-workflow/04-03-SUMMARY.md

# Source files:
@src/context/RoleContext.jsx
@src/components/Sidebar.jsx
@src/components/Layout.jsx
@src/pages/WorkflowPage.jsx
@src/pages/AgreementPage.jsx
@src/pages/DashboardPage.jsx

**Tech stack available:** React 18, react-router-dom@6, Tailwind CSS 3, @supabase/supabase-js
**Established patterns:** RoleContext with switchRole/useRole hook, NavLink active states, localStorage persistence, vanderdev design system (dark bg, orange accents, neutral borders)
**Constraining decisions:**
- [02-03]: localStorage for selected employee ID — persist across reloads
- [02-03]: Role filtering at API layer, not RLS — getAgreementsForRole filters by role param
- [04-03]: Temp role switcher on WorkflowPage — Phase 5 replaces with global switcher
- [01-03]: No clsx/twMerge — plain string concatenation for className logic
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RoleSwitcher component and integrate into Sidebar</name>
  <files>src/components/RoleSwitcher.jsx, src/components/Sidebar.jsx</files>
  <action>
Create a RoleSwitcher component that:
1. Uses useRole() to get employees, currentEmployee, switchRole, role
2. Groups employees by role (employee, manager, admin) for organized display
3. Shows current identity prominently: name, role badge (colored — orange for employee, blue for manager, green for admin), department
4. Provides a dropdown/selector to pick a different employee identity
5. Uses the vanderdev design system: bg-neutral-900/neutral-800 borders, orange accent for active state, text-neutral-300/400 for labels

Design spec for the switcher card (sidebar footer area):
- Current identity: employee name in white, role as a small colored Badge, department in neutral-400 text-xs
- Click/tap expands a dropdown listing all employees grouped by role header
- Each option shows: name, title, department in compact format
- Selection calls switchRole(employeeId), dropdown closes
- Smooth transition (150ms) on expand/collapse

Integrate into Sidebar.jsx:
- Replace the `{/* Role switcher placeholder — Phase 5 */}` comment in the desktop sidebar footer div with `<RoleSwitcher />`
- Do the same in the MobileNav component's footer div
- Import useRole is NOT needed in Sidebar itself — RoleSwitcher handles its own context

Do NOT use any external library for the dropdown — a simple div with conditional rendering and onClick handlers matches the existing pattern (no headlessui, no radix).
  </action>
  <verify>
- Dev server running: npm run dev
- Sidebar footer shows current employee name, role badge, and department
- Clicking the switcher expands a grouped list of all 8 seed employees
- Selecting a different employee updates the displayed identity
- Page reload preserves selection (localStorage)
- Mobile nav also shows the switcher in footer
  </verify>
  <done>RoleSwitcher component renders in both desktop and mobile sidebar footers, allows switching between all seed employees, persists selection via localStorage</done>
</task>

<task type="auto">
  <name>Task 2: Remove WorkflowPage temp switcher and ensure all pages respond to role changes</name>
  <files>src/pages/WorkflowPage.jsx, src/pages/AgreementPage.jsx</files>
  <action>
WorkflowPage cleanup:
1. Remove the temporary `<select>` role switcher (lines ~307-317 in the current file — the select element and its wrapping div)
2. Keep the "Viewing as {roleLabel} — {name}" text — it provides useful context
3. The page already uses useRole() and reloads data via the loadData useCallback when currentEmployee changes — verify this still works after removing the temp switcher

AgreementPage verification:
1. Read AgreementPage.jsx and verify it uses useRole() for currentEmployee context
2. If it doesn't refresh form state on role switch, add a useEffect keyed on currentEmployee.id that resets form state (clear formData back to defaults, clear validation errors) so switching roles mid-form-fill gives a clean slate
3. The EmployeeInfoSection already reads from RoleContext — it should update automatically

DashboardPage is a placeholder — no changes needed (Phase 6 builds it out).

Ensure no other files reference the temp switcher or import switchRole outside of RoleSwitcher and RoleContext.
  </action>
  <verify>
- WorkflowPage no longer shows the old `<select>` role switcher
- Switching roles via the new sidebar RoleSwitcher updates WorkflowPage data (agreements list changes based on new role)
- Switching roles on AgreementPage resets form to clean state for new employee
- No console errors on role switch
  </verify>
  <done>Temp role switcher removed from WorkflowPage, all pages correctly respond to global role changes via sidebar RoleSwitcher, form state resets on role switch</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Dev server starts without errors (`npm run dev`)
- [ ] RoleSwitcher visible in sidebar footer on desktop and mobile
- [ ] Can switch between all 8 employees across 3 roles
- [ ] WorkflowPage shows different agreements based on selected role
- [ ] AgreementPage employee info updates and form resets on role switch
- [ ] localStorage persistence works across page reload
- [ ] No console errors or warnings
- [ ] No temp role switcher remains anywhere in codebase
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Role switcher is always visible and functional
- All pages respond to role changes
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/05-role-switcher-demo/05-01-SUMMARY.md`
</output>
