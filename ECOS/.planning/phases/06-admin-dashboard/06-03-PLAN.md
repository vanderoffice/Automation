---
phase: 06-admin-dashboard
plan: 03
type: execute
---

<objective>
Build the audit trail viewer — a searchable, filterable log of all signature events and form changes, proving UETA-compliant record-keeping to executives.

Purpose: The audit trail is the legal backbone of the system. Showing executives a clean, searchable audit log demonstrates that web-based signatures produce superior records to scattered PDF files.
Output: Audit trail section in DashboardPage with search, filter, and paginated event display.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-admin-dashboard/06-01-SUMMARY.md
@.planning/phases/06-admin-dashboard/06-02-SUMMARY.md

# Key source files:
@src/pages/DashboardPage.jsx
@src/lib/api/audit.js
@src/lib/api/index.js
@src/components/ui/Card.jsx
@src/components/ui/Badge.jsx
@src/components/ui/TextInput.jsx
@src/components/ui/Select.jsx
@src/components/DemoBanner.jsx

**Tech stack available:** React 18, Supabase JS, Tailwind CSS 3
**Established patterns:** getRecentActivity(limit) returns audit entries with joined employees + agreements data, Card/Badge/TextInput/Select design system components

**Constraining decisions:**
- getRecentActivity(50) fetches last 50 audit log entries with employee and agreement joins
- getAuditLog(agreementId) for per-agreement filtering
- Audit log entries have: id, agreement_id, actor_id, action, details (jsonb), created_at, plus joined employees(*) and agreements(*)
- Action types in demo data: agreement_submitted, signature_recorded, agreement_completed

**Demo data available:** ~30+ audit log entries across 13 agreements, covering agreement_submitted, signature_recorded, and agreement_completed actions. Each has actor info via employee join.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build audit trail viewer with search and filter</name>
  <files>src/pages/DashboardPage.jsx</files>
  <action>
Add an "Audit Trail" section at the bottom of the dashboard (below expiring agreements). This is the fullest section — it should feel like a real audit log viewer.

Load audit data via getRecentActivity(100) on dashboard mount (reuse the same data loading pattern).

**Display as a table-style list within a Card:**
Each audit entry row shows:
- Timestamp (formatted as "Feb 6, 2026 2:30 PM" style — use toLocaleString)
- Action (human-readable label mapped from action type: "Agreement Submitted", "Signature Recorded", "Agreement Completed")
- Actor name (from joined employees data: first_name + last_name)
- Details (from jsonb details: show signer_role for signatures, from/to status for transitions)
- A subtle row divider between entries

**Action type label map:**
- agreement_submitted → "Submitted" with accent Badge
- signature_recorded → "Signed" with success Badge
- agreement_completed → "Completed" with success Badge
- (default) → capitalize the action string

**Search/filter controls (above the table):**
- Text search input (TextInput component) — filters by actor name or action type (client-side filter on loaded data)
- Action type dropdown (Select component) — filter by "All", "Submitted", "Signed", "Completed"
- Both filters work together (AND logic)

Use useState for search term and filter selections. Filter the loaded audit data client-side before rendering — with 100 entries, client-side filtering is perfectly fine.

Keep the table compact — this is a dense information display. Use text-xs or text-sm for most content, with the action type as the visual anchor per row.
  </action>
  <verify>Audit trail section shows timestamped entries with actor names and action badges. Search filters entries by name. Dropdown filters by action type.</verify>
  <done>Audit trail renders all entries, search filters by actor name, dropdown filters by action type, both filters work together, timestamps are human-readable.</done>
</task>

<task type="auto">
  <name>Task 2: Add audit detail expansion and update DemoBanner for dashboard</name>
  <files>src/pages/DashboardPage.jsx, src/components/DemoBanner.jsx</files>
  <action>
**Audit detail expansion:**
Add click-to-expand on audit trail rows. When clicked, show the full jsonb details object formatted as key-value pairs (from_status, to_status, signer_role, agreement_id, etc.). Use a slide-down transition (just toggle a boolean per row ID).

Style the expanded details in a monospace font (font-mono) on a slightly lighter background (bg-neutral-900/50) — feels like viewing raw audit data, which impresses technical executives.

**DemoBanner update:**
Update the DemoBanner's getHint function to provide a more useful dashboard-specific hint. Currently it has a generic "The admin dashboard shows compliance status across all departments." Replace with role-aware hints:
- admin: "This dashboard shows organization-wide compliance. Try signing a pending approval, then check the audit trail."
- manager: "The admin dashboard shows full compliance data. Switch to an admin role to see approval actions."
- employee: "The admin dashboard is an admin-only view. Switch to an admin role to explore."

**Final polish:**
Add a page-level header update — change the subtitle from "Compliance and audit dashboard" to show the current fiscal year and total agreement count, e.g., "FY 2025-2026 · 13 agreements tracked"

Ensure the entire DashboardPage has consistent spacing (space-y-6 between major sections) and the animate-in class on the root container.
  </action>
  <verify>Clicking an audit row expands to show raw details in monospace. DemoBanner shows role-appropriate hints on dashboard page. Page header shows fiscal year and agreement count.</verify>
  <done>Audit rows expand to show details, DemoBanner hints are role-specific, page header shows dynamic stats, overall dashboard spacing is consistent. Phase 6 complete.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Audit trail shows timestamped, labeled entries
- [ ] Search filters by actor name
- [ ] Action type dropdown filters correctly
- [ ] Click-to-expand shows raw audit details
- [ ] DemoBanner shows role-appropriate dashboard hints
- [ ] All dashboard sections (stats, approvals, departments, expiring, audit) render together without layout issues
- [ ] No console errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Audit trail is searchable and filterable
- Expanded details show raw audit metadata
- DemoBanner provides useful dashboard context
- Phase 6 complete — admin dashboard fully functional
</success_criteria>

<output>
After completion, create `.planning/phases/06-admin-dashboard/06-03-SUMMARY.md`
</output>
