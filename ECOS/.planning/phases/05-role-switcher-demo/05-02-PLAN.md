---
phase: 05-role-switcher-demo
plan: 02
type: execute
---

<objective>
Expand demo seed data to showcase realistic variety — more agreements in diverse workflow states, more departments represented, and agreements distributed across time to make the demo feel lived-in rather than freshly bootstrapped.

Purpose: Executives need to see a realistic-looking system with agreements at every stage of the workflow. The current seed data (3 agreements: 1 draft, 1 pending_manager, 1 completed) is too sparse for a convincing demo. We need enough variety that every role sees meaningful content.
Output: Expanded seed SQL, optional reset-seed mechanism for re-running demo fresh.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Key prior phase work:
@.planning/phases/02-database-api/02-01-SUMMARY.md
@.planning/phases/02-database-api/02-03-SUMMARY.md

# Source files:
@sql/004-seed-data.sql
@sql/001-schema.sql
@src/lib/api/agreements.js
@src/lib/api/signatures.js
@src/lib/api/workflow.js

**Tech stack available:** PostgreSQL 15, PostgREST, Supabase JS client
**Established patterns:** Fixed UUIDs for seed data, ON CONFLICT DO NOTHING for idempotency, ecos schema namespace, fiscal_year as string (e.g., '2024-2025')
**Constraining decisions:**
- [02-01]: IF NOT EXISTS on all CREATE TABLE/INDEX for idempotent migrations
- [02-03]: 8 fictional employees across 3 roles and 4 departments already exist
- [02-02]: persistSession: false — demo app with simulated auth
</context>

<tasks>

<task type="auto">
  <name>Task 1: Expand seed data with diverse agreements and workflow states</name>
  <files>sql/005-expanded-seed.sql</files>
  <action>
Create a new migration file (NOT modifying 004 — additive only) that inserts additional demo agreements to ensure every role perspective has interesting content:

Target state after seeding (existing + new):
- **Employee perspective (Alex Rivera):** 1 draft (existing), 1 new pending_employee (just submitted, needs their signature), 1 completed (from prior year)
- **Employee perspective (Jordan Chen):** 1 pending_manager (existing), 1 completed (prior year annual renewal)
- **Employee perspective (Pat Kim):** 1 pending_admin (fully signed by employee + manager, waiting admin)
- **Manager perspective (Morgan Hayes):** 2-3 pending_manager agreements to review (from ODI employees)
- **Manager perspective (Taylor Brooks):** 1-2 pending_manager from CDT employees
- **Admin perspective (Casey Nguyen):** 2 pending_admin agreements waiting final sign-off
- **Admin perspective (Drew Martinez):** 1 pending_admin from SCO

Add approximately 8-10 new agreements with corresponding signatures and audit log entries. Use:
- Fixed UUIDs continuing the existing pattern (aaaaaaaa-bbbb-cccc-aaaa-aaaaaaaaa004 through 013)
- Signature UUIDs: aaaaaaaa-bbbb-cccc-5555-aaaaaaaaa005 through 020
- Audit log UUIDs: aaaaaaaa-bbbb-cccc-1111-bbbbbbbb0008 through 030
- Mix of new_updated and annual_renewal tracks
- Spread created_at dates across last 30 days for realistic feel
- Fiscal year: '2025-2026' for current-year agreements, '2024-2025' for the "prior year completed" ones
- All ON CONFLICT DO NOTHING for idempotency

Include agreements that showcase:
1. A brand-new submission (pending_employee, created today)
2. Several mid-workflow (pending_manager with employee signature)
3. A couple near completion (pending_admin with employee + manager signatures)
4. Several completed agreements (all 3 signatures) from various dates
5. At least one annual_renewal vs new_updated variety

Each agreement needs matching signatures for its status:
- pending_employee: no signatures yet
- pending_manager: 1 employee signature
- pending_admin: 2 signatures (employee + manager)
- completed: 3 signatures (employee + manager + admin), plus completed_at and expires_at

Each signature/transition also needs a matching audit_log entry.
  </action>
  <verify>
Run the migration against the VPS Supabase:
```bash
# From ECOS directory
cat sql/005-expanded-seed.sql | docker exec -i supabase-db psql -U supabase_admin -d postgres
```
Then verify with:
```bash
docker exec supabase-db psql -U supabase_admin -d postgres -c "SELECT status, count(*) FROM ecos.agreements GROUP BY status ORDER BY status;"
```
Expected: counts across draft, pending_employee, pending_manager, pending_admin, completed
  </verify>
  <done>sql/005-expanded-seed.sql creates 8-10 new agreements with matching signatures and audit entries, covering all workflow states, all demo roles have interesting content to view</done>
</task>

<task type="auto">
  <name>Task 2: Add demo reset capability</name>
  <files>sql/099-reset-demo.sql, src/lib/api/demo.js, src/lib/api/index.js</files>
  <action>
Create a SQL reset script and thin API wrapper so the demo can be reset to its seeded state:

1. **sql/099-reset-demo.sql**: A script that:
   - TRUNCATE CASCADE all ecos tables (audit_log, signatures, agreement_access_groups, agreements, employees, departments, form_versions)
   - Then re-run 004-seed-data.sql content and 005-expanded-seed.sql content (copy the INSERT statements into this file — self-contained reset)
   - Wrapped in BEGIN/COMMIT

2. **src/lib/api/demo.js**: Export a `resetDemoData()` function that:
   - Calls a Supabase RPC function to reset data (preferred), OR
   - Since this is a demo and RLS is permissive, uses the Supabase client to delete all agreements (CASCADE handles signatures/audit/groups), then re-insert seed data via the API
   - Actually — simplest approach: just call DELETE on each table in dependency order (audit_log, signatures, agreement_access_groups, agreements, employees, departments), then reload the page. The SQL reset script is what the user runs manually or via a deploy script. The in-app button just clears and reloads.
   - Simplest: `resetDemoData()` deletes all rows from agreements (cascade handles rest via FK), then deletes employees, departments. On page reload, the app re-fetches from the DB which will be empty — user runs the seed SQL to repopulate.
   - Even simpler for demo: just provide the SQL script. In-app reset is overkill for an exec demo. Skip the API wrapper.

Actually, for a clean demo: just provide the SQL script. The presenter runs it before demo. Skip in-app reset — it adds complexity for minimal demo value and the exec audience won't see it.

So: Create sql/099-reset-demo.sql only. Skip the JS API wrapper.

3. **Update src/lib/api/index.js**: No changes needed if skipping in-app reset.
  </action>
  <verify>
Test the reset script:
```bash
cat sql/099-reset-demo.sql | docker exec -i supabase-db psql -U supabase_admin -d postgres
```
Then verify data is back to expected state:
```bash
docker exec supabase-db psql -U supabase_admin -d postgres -c "SELECT count(*) FROM ecos.agreements;"
docker exec supabase-db psql -U supabase_admin -d postgres -c "SELECT count(*) FROM ecos.employees;"
```
  </verify>
  <done>sql/099-reset-demo.sql exists, resets all ecos data and re-seeds to demo state in a single script execution</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] sql/005-expanded-seed.sql exists with diverse agreements
- [ ] Migration runs without errors
- [ ] All workflow states represented in data
- [ ] Each role perspective has meaningful content (2+ items visible)
- [ ] sql/099-reset-demo.sql resets data cleanly
- [ ] App loads correctly after seeding (no broken references)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Demo data is rich enough that every role sees interesting content
- Reset script works for fresh demo setup
</success_criteria>

<output>
After completion, create `.planning/phases/05-role-switcher-demo/05-02-SUMMARY.md`
</output>
