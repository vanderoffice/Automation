---
phase: 06-admin-dashboard
plan: 01
type: execute
---

<objective>
Build the compliance overview section of the admin dashboard with department compliance rates, status summary cards, and expiring agreement alerts.

Purpose: Give admins an at-a-glance view of organizational compliance health — the most impressive "executive pitch" component of the demo.
Output: Working DashboardPage with summary stat cards, per-department compliance breakdown, and expiring agreements section.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/phase-prompt.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Key source files:
@src/pages/DashboardPage.jsx
@src/lib/api/agreements.js
@src/lib/api/employees.js
@src/lib/api/index.js
@src/components/ui/Card.jsx
@src/components/ui/Badge.jsx
@src/context/RoleContext.jsx
@src/pages/WorkflowPage.jsx
@src/components/DemoBanner.jsx

**Tech stack available:** React 18, Supabase JS, Tailwind CSS 3, vanderdev.net design tokens
**Established patterns:** Card component for sections, Badge for status pills, useRole() for context, data-error-return from API, animate-in for page transitions, status label/variant maps

**Constraining decisions:**
- No clsx/twMerge — plain string concatenation for className logic
- Role filtering at API layer via getAgreementsForRole()
- Design language: #0b0b0b cards, neutral-800 borders, orange-500 accent, Inter font
- Existing API helpers: getAgreements(filters), getExpiringAgreements(days), getAgreementsByStatus(status)

**Demo data available:** 13 agreements across 5 statuses, 4 departments (ODI, CDT, SCO, CalHR), 8 employees across 3 roles. Expiring agreements have `expires_at` set ~335-347 days out.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build compliance overview stat cards and department breakdown</name>
  <files>src/pages/DashboardPage.jsx</files>
  <action>
Replace the placeholder DashboardPage with a full admin dashboard compliance overview. Load all agreements via getAgreements() on mount and compute stats client-side:

**Summary stat cards (top row, 4 cards in a responsive grid):**
- Total Agreements (count of all non-draft)
- Completed (count of status=completed, green accent)
- Pending Review (count of pending_manager + pending_admin, orange accent)
- Compliance Rate (completed / total non-draft as percentage, green if >=80%, yellow if >=60%, red if <60%)

Use Card component for each stat. Display the number large (text-3xl font-bold) with label underneath. Use colored accent borders or text per stat type.

**Department compliance table (below stats):**
Group agreements by department (from employees.departments.name). For each department show: department name, total agreements, completed count, compliance percentage, visual progress bar (tailwind bg fill). Sort by compliance rate ascending (worst first — draws attention to action needed).

Use the same dark card styling as WorkflowPage. Follow the pattern from WorkflowPage for loading/error states and animate-in. Dashboard should always show all data regardless of current role — it's an admin view.

Do NOT create separate component files — keep everything in DashboardPage.jsx (same pattern as WorkflowPage which has SignatureTimeline and AgreementCard inline). Only extract if something would be reused elsewhere.
  </action>
  <verify>Dev server shows DashboardPage with 4 stat cards and department breakdown table populated with demo data. No console errors.</verify>
  <done>Dashboard loads, stat cards show correct counts from demo data, department table shows per-department compliance rates with progress bars, loading/error states handled.</done>
</task>

<task type="auto">
  <name>Task 2: Add expiring agreements alert section</name>
  <files>src/pages/DashboardPage.jsx</files>
  <action>
Below the department breakdown, add an "Expiring Soon" section that calls getExpiringAgreements(90) to find agreements expiring within 90 days. Display as a list within a Card:

- If no expiring agreements: show a green "All agreements current" message
- If expiring agreements exist: show each with employee name, department, days until expiry, and a warning Badge

Use the existing Badge component with 'warning' variant for items expiring within 30 days, 'accent' for 31-60 days, 'neutral' for 61-90 days.

Format days until expiry as "Expires in X days" or "Expires today" or "Expired X days ago" for negative values.

NOTE: Demo seed data sets expires_at ~335-347 days out. The 90-day window will likely show zero results with current seed data. That's fine — the "All agreements current" empty state demonstrates the feature. The section structure matters for the executive demo.

Also add a small "Last updated" timestamp at the bottom of the dashboard showing when data was loaded (use new Date() at load time, format as locale string).
  </action>
  <verify>Dashboard shows "Expiring Soon" section. With current seed data, likely shows "All agreements current" empty state. Last updated timestamp appears at bottom.</verify>
  <done>Expiring section renders correctly, handles both empty and populated states, last-updated timestamp shows at bottom of dashboard.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] DashboardPage loads without errors
- [ ] 4 stat cards show correct aggregate data
- [ ] Department compliance table shows per-department breakdown
- [ ] Expiring agreements section renders (empty state or populated)
- [ ] Page follows vanderdev.net design language (dark cards, orange accents)
- [ ] No TypeScript/JSX warnings in console
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Dashboard renders with real data from Supabase
- Visual design matches existing app aesthetic
- No new dependencies added
</success_criteria>

<output>
After completion, create `.planning/phases/06-admin-dashboard/06-01-SUMMARY.md`
</output>
